# 查看存储引擎

查看mysql提供什么存储引擎：

```mysql
show engines;
show engines \G;
```

# 设置系统默认的存储引擎

- 查看默认的存储引擎：

```mysql
show variables like '%storage_engine%'; 
#或
SELECT @@default_storage_engine;
```

- 修改默认的存储引擎

```mysql
SET DEFAULT_STORAGE_ENGINE=MyISAM;
#或修改my.cnf

default-storage-engine=MyISAM 
# 重启服务 
systemctl restart mysqld.service
```

# 设置表的存储引擎

## 创建表时指定存储引擎

```mysql
CREATE TABLE 表名( 
  	建表语句; 
) ENGINE = 存储引擎名称;
```

## 修改表的存储引擎

```mysql
ALTER TABLE 表名 ENGINE = 存储引擎名称;
```

# 存储引擎介绍

## InnoDB 引擎

**具备外键支持功能的事务存储引擎** 

- MySQL从3.23.34a开始就包含InnoDB存储引擎。 **大于等于5.5之后，默认采用InnoDB引擎 ** 。 
- InnoDB是MySQL的**默认事务型引擎** ，它被设计用来处理大量的短期(short-lived)事务。可以确保事务的完整提交(Commit)和回滚(Rollback)。
- 除了增加和查询外，还需要更新、删除操作，那么，应优先选择InnoDB存储引擎。
- ==除非有非常特别的原因需要使用其他的存储引擎，否则应该优先考虑InnoDB引擎。==
- 数据文件结构：
- - 表名.frm 存储表结构（MySQL8.0时，合并在表名.ibd中）
  - 表名.ibd 存储数据和索引
- InnoDB是 **为处理巨大数据量的最大性能设计 ** 。
- - 在以前的版本中，字典数据以元数据文件、非事务表等来存储。现在这些元数据文件被删除了。比如： .frm ， .par ， .trn ， .isl ， .db.opt 等都在MySQL8.0中不存在了。
- 对比MyISAM的存储引擎， **InnoDB写的处理效率差一些** ，并且会占用更多的磁盘空间以保存数据和索引。
- MyISAM只缓存索引，不缓存真实数据；InnoDB不仅缓存索引还要缓存真实数据， **对内存要求较高**  ，而且内存大小对性能有决定性的影响。

##  MyISAM 引擎

**主要的非事务处理存储引擎** 

- MyISAM提供了大量的特性，包括全文索引、压缩、空间函数(GIS)等，但MyISAM**不支持事务、行级 锁、外键** ，有一个毫无疑问的缺陷就是**崩溃后无法安全恢复** 。 
- 5.5之前默认的存储引擎
- 优势是访问的 速度快 ，对事务完整性没有要求或者以SELECT、INSERT为主的应用
- 针对数据统计有额外的常数存储。故而 count(*) 的查询效率很高
- 数据文件结构：
- - 表名.frm 存储表结构
  - 表名.MYD 存储数据 (MYData)
  - 表名.MYI 存储索引 (MYIndex)
- 应用场景：只读应用或者以读为主的业务

##  MyISAM和InnoDB

| 对比项     | MyISAM                       | InnoDB                                   |
| ------- | ---------------------------- | ---------------------------------------- |
| 外键      | 不支持                          | 支持                                       |
| 事务      | 不支持                          | 支持                                       |
| 行表锁     | 表锁，即使操作一条记录也会锁住整个表，不适合高并发的操作 | 行锁，操作时只锁某一行，不对其它行有影响，适合高并发的操作            |
| 缓存      | 只缓存索引，不缓存真实数据                | 不仅缓存索引还要缓存真实数据，对内存要求较 高，而且内存大小对性能有决定性的影响 |
| 自带系统表使用 | Y                            | N                                        |
| 关注点     | 性能：节省资源、消耗少、简单业              | 事务：并发写、事务、更大资源                           |
| 默认安装    | Y                            | Y                                        |
| 默认使用    | N                            | Y                                        |

## Archive 引擎

**用于数据存档**

| 特征                           | 支持     |
| ---------------------------- | ------ |
| B树索引                         | 不支持    |
| 备份/时间点恢复 （在服务器中实现，而不是在存储引擎中） | 支持     |
| 集群数据库支持                      | 不支持    |
| 聚集索引                         | 不支持    |
| 压缩数据                         | 支持     |
| 数据缓存                         | 不支持    |
| 加密数据（加密功能在服务器中实现）            | 支持     |
| 外键支持                         | 不支持    |
| 全文检索索引                       | 不支持    |
| 地理空间数据类型支持                   | 支持     |
| 地理空间索引支持                     | 不支持    |
| 哈希索引                         | 不支持    |
| 索引缓存                         | 不支持    |
| 锁粒度                          | 行锁     |
| MVCC                         | 不支持    |
| 存储限制                         | 没有任何限制 |
| 交易                           | 不支持    |
| 更新数据字典的统计信息                  | 支持     |

## Blackhole 引擎

**丢弃写操作，读操作会返回空内容** 

## CSV 引擎

**存储数据时，以逗号分隔各个数据项** 

## Memory 引擎

**置于内存的表** 

### 概述

Memory采用的逻辑介质是 内存 ， 响应速度很快 ，但是当mysqld守护进程崩溃的时候 数据会丢失 。另外，要求存储的数据是数据长度不变的格式，比如，Blob和Text类型的数据不可用(长度不固定的)。

### 主要特征

- Memory同时 支持哈希（HASH）索引 和 B+树索引 。
- Memory表至少比MyISAM表要 快一个数量级 。 
- MEMORY 表的大小是受到限制 的。表的大小主要取决于两个参数，分别是 max_rows 和 max_heap_table_size 。其中，max_rows可以在创建表时指定；max_heap_table_size的大小默认为16MB，可以按需要进行扩大。
- 数据文件与索引文件分开存储。
- 缺点：其数据易丢失，生命周期短。基于这个缺陷，选择MEMORY存储引擎时需要特别小心。

### 使用Memory存储引擎的场景

- 目标数据比较小 ，而且非常 频繁的进行访问 ，在内存中存放数据，如果太大的数据会造成 内存溢 出 。可以通过参数 max_heap_table_size 控制Memory表的大小，限制Memory表的最大的大小。
- 如果 数据是临时的 ，而且 必须立即可用 得到，那么就可以放在内存中。
- 存储在Memory表中的数据如果突然间 丢失的话也没有太大的关系 。

### Federated 引擎

**访问远程表** 

- Federated引擎是访问其他MySQL服务器的一个 代理 ，尽管该引擎看起来提供了一种很好的 跨服务 器的灵活性 ，但也经常带来问题，因此 默认是禁用的 。 

### Merge引擎

**管理多个MyISAM表构成的表集合** 

###  NDB引擎

**MySQL集群专用存储引擎** 

也叫做 NDB Cluster 存储引擎，主要用于 MySQL Cluster 分布式集群 环境，类似于 Oracle 的 RAC 集群。

### 引擎对比

| 特点      | MyISAM                       | InnoDB                                 | MEMORY | MERGE | NDB  |
| ------- | ---------------------------- | -------------------------------------- | ------ | ----- | ---- |
| 存储限制    | 有                            | 64TB                                   | 有      | 没有    | 有    |
| 事务安全    |                              | 支持                                     |        |       |      |
| 锁机制     | 表锁，即使操作一条记录也会锁住整个表，不适合高并发的操作 | 行锁，操作时只锁某一行，不对其它行有影响，适合高并发的操作          | 表锁     | 表锁    | 行锁   |
| B树索引    | 支持                           | 支持                                     | 支持     | 支持    | 支持   |
| 哈希索引    |                              |                                        | 支持     |       | 支持   |
| 全文索引    | 支持                           |                                        |        |       |      |
| 集群索引    |                              | 支持                                     |        |       |      |
| 数据缓存    |                              | 支持                                     | 支持     |       | 支持   |
| 索引缓存    | 只缓存索引，不缓存真实数据                | 不仅缓存索引还要缓存真实数据，对内存要求较高，而且内存大小对性能有决定性影响 | 支持     | 支持    | 支持   |
| 数据可压缩   | 支持                           |                                        |        |       |      |
| 空间使用    | 低                            | 高                                      | N/A    | 低     | 低    |
| 内存使用    | 低                            | 高                                      | 中等     | 低     | 高    |
| 批量插入的速度 | 高                            | 低                                      | 高      | 高     | 高    |
| 支持外键    |                              | 支持                                     |        |       |      |

